<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Courses Payment Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .course-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .course-title { font-weight: bold; color: #333; }
        .course-price { color: #22c55e; font-weight: bold; }
        .test-btn { background: #22c55e; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-btn:hover { background: #16a34a; }
        .result { margin-top: 10px; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Advanced Courses Payment Test</h1>
    <p>Test payment functionality for all advanced courses in the system.</p>

    <div id="courses-container">
        <!-- Courses will be loaded here -->
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        const courses = [
            { id: 7, name: 'Advanced React.js with TypeScript', expectedPrice: 25000 },
            { id: 8, name: 'UI/UX-Focused React.js with TypeScript', expectedPrice: 25000 },
            { id: 1001, name: 'UI/UX Design Masterclass', expectedPrice: 20000 },
            { id: 1004, name: 'Python for Data Science & AI', expectedPrice: 20000 },
            { id: 1005, name: 'Artificial Intelligence & Machine Learning', expectedPrice: 20000 }
        ];

        async function loadCourses() {
            const container = document.getElementById('courses-container');

            for (const course of courses) {
                try {
                    const response = await fetch(`${API_BASE}/courses/${course.id}`);
                    const courseData = await response.json();

                    if (response.ok) {
                        const courseCard = document.createElement('div');
                        courseCard.className = 'course-card';
                        courseCard.innerHTML = `
                            <div class="course-title">${courseData.title}</div>
                            <div>Price: <span class="course-price">NPR ${courseData.price.toLocaleString()}</span></div>
                            <div>Level: ${courseData.level}</div>
                            <button class="test-btn" onclick="testPayment(${course.id}, ${courseData.price}, '${courseData.title}')">
                                Test Payment Intent
                            </button>
                            <div id="result-${course.id}" class="result" style="display: none;"></div>
                        `;
                        container.appendChild(courseCard);
                    } else {
                        console.error(`Failed to load course ${course.id}:`, courseData);
                    }
                } catch (error) {
                    console.error(`Error loading course ${course.id}:`, error);
                }
            }
        }

        async function testPayment(courseId, price, courseName) {
            const resultDiv = document.getElementById(`result-${courseId}`);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing payment intent creation...';

            try {
                // You'll need to replace this with a valid JWT token
                const token = localStorage.getItem('ocms_token') || 'your-jwt-token-here';

                const response = await fetch(`${API_BASE}/payments/create-intent`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        course_id: courseId,
                        amount: price
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        ✅ Payment intent created successfully!<br>
                        Course: ${courseName}<br>
                        Amount: NPR ${price.toLocaleString()} (${data.amount} paisa)<br>
                        Currency: ${data.currency}<br>
                        Payment ID: ${data.paymentId}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ Payment failed: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ Error: ${error.message}`;
            }
        }

        // Load courses when page loads
        loadCourses();
    </script>
</body>
</html></content>
<parameter name="filePath">d:\OCMS project\test-advanced-courses.html