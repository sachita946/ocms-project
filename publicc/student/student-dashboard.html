<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard | OCMS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #a5b4fc;
      --secondary: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --dark: #1f2937;
      --darker: #111827;
      --light: #f9fafb;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --border-radius: 8px;
      --border-radius-lg: 12px;
      --border-radius-xl: 16px;
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-warning: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      overflow-x: hidden;
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      width: 100%;
      height: 100vh;
      position: relative;
    }

    /* Sidebar */
    .sidebar {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 24px;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      position: relative;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
      pointer-events: none;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--border-radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 1;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--border-radius);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 20px;
      box-shadow: var(--shadow-md);
    }

    .logo-text {
      color: #ffffff;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.5px;
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 28px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--border-radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.08);
      position: relative;
      z-index: 1;
    }

    .avatar {
      width: 52px;
      height: 52px;
      border-radius: var(--border-radius-lg);
      background: var(--gradient-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #1f2937;
      font-size: 18px;
      box-shadow: var(--shadow-md);
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .user-info h3 {
      color: #ffffff;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .user-info p {
      color: #9ca3af;
      font-size: 14px;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      z-index: 1;
    }

    .nav-item {
      background: transparent;
      color: #d1d5db;
      border: 1px solid transparent;
      padding: 14px 18px;
      border-radius: var(--border-radius-lg);
      text-align: left;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 15px;
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }

    .nav-item:hover::before {
      left: 100%;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateX(4px);
    }

    .nav-item.active {
      background: var(--gradient-primary);
      color: white;
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: var(--shadow-lg);
      transform: translateX(8px);
    }

    .nav-item.active::after {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 60%;
      background: #ffffff;
      border-radius: 2px;
    }

    .logout-btn {
      margin-top: auto;
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      position: relative;
      z-index: 1;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
      color: #ef4444;
      transform: translateX(4px);
    }

    /* Main Content */
    main {
      padding: 32px;
      overflow-y: auto;
      position: relative;
    }

    /* Hero Section */
    .hero {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
      margin-bottom: 32px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 28px;
      border-radius: var(--border-radius-xl);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
      opacity: 0.5;
    }

    .hero-content {
      position: relative;
      z-index: 1;
    }

    .hero h1 {
      font-size: 32px;
      color: #ffffff;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .hero p {
      color: #d1d5db;
      font-size: 16px;
      margin-bottom: 16px;
    }

    .hero-stats {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stat-badge {
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .hero-actions {
      position: relative;
      z-index: 1;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-xl);
      padding: 24px;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--border-radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-bottom: 16px;
      background: var(--gradient-primary);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 4px;
    }

    .stat-label {
      color: #9ca3af;
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Panels */
    .panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius-xl);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-lg);
      display: none;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);
      pointer-events: none;
    }

    .panel.active {
      display: block;
      animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .panel-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }

    .panel-title {
      font-size: 20px;
      font-weight: 600;
      color: #ffffff;
      margin: 0;
    }

    .panel-content {
      position: relative;
      z-index: 1;
    }

    /* Course Cards */
    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .course-card {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: var(--border-radius-lg);
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .course-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .course-card:hover::before {
      opacity: 1;
    }

    .course-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .course-title {
      font-size: 18px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .course-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .course-instructor {
      color: #9ca3af;
      font-size: 14px;
    }

    .course-price {
      background: var(--gradient-success);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .course-progress {
      margin-top: 12px;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 12px;
      color: #9ca3af;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--border-radius-lg);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
    }

    /* Rating Stars */
    .rating-stars {
      display: flex;
      gap: 8px;
      font-size: 24px;
      cursor: pointer;
    }

    .rating-stars i {
      color: #d1d5db;
      transition: color 0.3s ease;
    }

    .rating-stars i:hover,
    .rating-stars i.active {
      color: #fbbf24;
    }

    .rating-stars i.fas {
      color: #fbbf24;
    }

    /* Review Cards */
    .review-card {
      padding: 20px;
      border-radius: var(--border-radius-lg);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 16px;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .review-course {
      font-weight: 600;
      color: #ffffff;
    }

    .review-date {
      color: #9ca3af;
      font-size: 14px;
    }

    .review-rating {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
    }

    .review-rating i {
      color: #fbbf24;
      font-size: 16px;
    }

    .review-comment {
      color: #d1d5db;
      line-height: 1.5;
    }

    /* Lists */
    .list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .list-item {
      padding: 16px;
      border-radius: var(--border-radius-lg);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      transition: all 0.3s ease;
    }

    .list-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateX(4px);
    }

    .list-item-content h4 {
      color: #ffffff;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .list-item-content p {
      color: #9ca3af;
      font-size: 14px;
    }

    .list-item-meta {
      text-align: right;
      color: #9ca3af;
      font-size: 12px;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: #9ca3af;
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .sidebar {
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        max-height: 200px;
      }
      .hero {
        flex-direction: column;
        text-align: center;
      }
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    @media (max-width: 768px) {
      main {
        padding: 20px;
      }
      .hero {
        padding: 20px;
      }
      .hero h1 {
        font-size: 24px;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .course-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">ðŸŽ“</div>
        <div class="logo-text">OCMS Student</div>
      </div>

      <div class="user-card">
        <div class="avatar" id="avatar">S</div>
        <div class="user-info">
          <h3 id="userName">Student</h3>
          <p id="userEmail">email@example.com</p>
        </div>
      </div>

      <nav class="nav">
        <button class="nav-item active" data-section="overview">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </button>
        <button class="nav-item" data-section="courses">
          <i class="fas fa-book"></i>
          <span>Browse Courses</span>
        </button>
        <button class="nav-item" data-section="enrollments">
          <i class="fas fa-user-check"></i>
          <span>My Enrollments</span>
        </button>
        <button class="nav-item" data-section="resources">
          <i class="fas fa-file-alt"></i>
          <span>Course Resources</span>
        </button>
        <button class="nav-item" data-section="progress">
          <i class="fas fa-chart-line"></i>
          <span>Progress</span>
        </button>
        <button class="nav-item" data-section="certificates">
          <i class="fas fa-certificate"></i>
          <span>Certificates</span>
        </button>
        <button class="nav-item" data-section="payments">
          <i class="fas fa-credit-card"></i>
          <span>Payments</span>
        </button>
        <button class="nav-item" data-section="reviews">
          <i class="fas fa-star"></i>
          <span>Reviews</span>
        </button>
        <button class="nav-item" data-section="notifications">
          <i class="fas fa-bell"></i>
          <span>Notifications</span>
        </button>
      </nav>

      <button class="nav-item logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </aside>

    <main>
      <div class="hero">
        <div class="hero-content">
          <h1>Welcome back, <span id="welcomeName">Student</span>! ðŸ‘‹</h1>
          <p>Continue your learning journey and track your progress</p>
          <div class="hero-stats">
            <div class="stat-badge" id="roleBadge">Student</div>
            <div class="stat-badge" id="currentDate"></div>
          </div>
        </div>
        <div class="hero-actions">
          <a href="/student/courses.html" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Browse Courses
          </a>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="stat-value" id="stat-enrollments">0</div>
          <div class="stat-label">Enrollments</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-play-circle"></i>
          </div>
          <div class="stat-value" id="stat-active">0</div>
          <div class="stat-label">Active Courses</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-value" id="stat-completed">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-certificate"></i>
          </div>
          <div class="stat-value" id="stat-certificates">0</div>
          <div class="stat-label">Certificates</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="stat-value" id="stat-payments">0</div>
          <div class="stat-label">Payments</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-brain"></i>
          </div>
          <div class="stat-value" id="stat-quizzes">0</div>
          <div class="stat-label">Quiz Attempts</div>
        </div>
      </div>

      <div id="section-overview" class="panel active">
        <div class="panel-header">
          <h2 class="panel-title">Quick Overview</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="overview-loading">Loading your dashboard...</div>
          <div id="overview-content" style="display: none;">
            <div class="course-grid" id="recent-courses"></div>
            <div style="margin-top: 32px;">
              <h3 style="color: #ffffff; margin-bottom: 16px;">Recent Activity</h3>
              <ul class="list" id="recent-activity"></ul>
            </div>
          </div>
        </div>
      </div>

      <div id="section-courses" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Browse Courses</h2>
        </div>
        <div class="panel-content">
          <p style="color: #9ca3af; margin-bottom: 20px;">Explore all available courses organized by semester and subject.</p>
          <a href="/student/courses.html" class="btn btn-primary">
            <i class="fas fa-search"></i>
            View All Courses
          </a>
        </div>
      </div>

      <div id="section-enrollments" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">My Enrollments</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="enrollments-loading">Loading enrollments...</div>
          <ul class="list" id="enrollments-list" style="display: none;"></ul>
        </div>
      </div>

      <div id="section-resources" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Course Resources</h2>
        </div>
        <div class="panel-content">
          <p style="color: #9ca3af; margin-bottom: 20px;">Access notes, questions, and materials for your enrolled courses.</p>
          <a href="/student/course-resources.html" class="btn btn-primary">
            <i class="fas fa-file-alt"></i>
            View Course Resources
          </a>
        </div>
      </div>

      <div id="section-progress" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Course Progress</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="progress-loading">Loading progress...</div>
          <ul class="list" id="progress-list" style="display: none;"></ul>
        </div>
      </div>

      <div id="section-certificates" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Certificates</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="certificates-loading">Loading certificates...</div>
          <ul class="list" id="certificates-list" style="display: none;"></ul>
        </div>
      </div>

      <div id="section-payments" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Payment History</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="payments-loading">Loading payments...</div>
          <ul class="list" id="payments-list" style="display: none;"></ul>
        </div>
      </div>

      <div id="section-reviews" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">My Reviews</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="reviews-loading">Loading reviews...</div>
          <div id="reviews-content" style="display: none;">
            <div class="review-form" style="margin-bottom: 32px;">
              <h3 style="color: #ffffff; margin-bottom: 16px;">Write a Review</h3>
              <form id="reviewForm">
                <div style="margin-bottom: 16px;">
                  <label style="color: #d1d5db; display: block; margin-bottom: 8px;">Select Course</label>
                  <select id="reviewCourseId" required style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #ffffff;">
                    <option value="" style="background: #1f2937; color: #ffffff;">Choose a course...</option>
                  </select>
                </div>
                <div style="margin-bottom: 16px;">
                  <label style="color: #d1d5db; display: block; margin-bottom: 8px;">Rating</label>
                  <div class="rating-stars" id="ratingStars">
                    <i class="far fa-star" data-rating="1"></i>
                    <i class="far fa-star" data-rating="2"></i>
                    <i class="far fa-star" data-rating="3"></i>
                    <i class="far fa-star" data-rating="4"></i>
                    <i class="far fa-star" data-rating="5"></i>
                  </div>
                  <input type="hidden" id="reviewRating" name="rating" required>
                </div>
                <div style="margin-bottom: 16px;">
                  <label style="color: #d1d5db; display: block; margin-bottom: 8px;">Comment</label>
                  <textarea id="reviewComment" name="comment" rows="4" placeholder="Share your experience with this course..." style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #ffffff; resize: vertical;" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="submitReviewBtn">
                  <i class="fas fa-paper-plane"></i>
                  Submit Review
                </button>
              </form>
            </div>
            <div class="reviews-list">
              <h3 style="color: #ffffff; margin-bottom: 16px;">Your Reviews</h3>
              <div id="reviewsList"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="section-notifications" class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Notifications & Activity</h2>
        </div>
        <div class="panel-content">
          <div class="loading" id="notifications-loading">Loading notifications...</div>
          <div id="notifications-content" style="display: none;">
            <ul class="list" id="notifications-list"></ul>
            <div style="height: 20px;"></div>
            <h3 style="color: #ffffff; margin-bottom: 16px;">Recent Activity</h3>
            <ul class="list" id="activities-list"></ul>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Resolve backend API base to avoid 405 when page is served from a different origin (e.g., Live Server)
    const BACKEND_ORIGIN = (window.OCMS_API_ORIGIN) || 'http://localhost:3000';
    const API_URL = `${BACKEND_ORIGIN}/api`;
    
    // Check for token in URL parameters and store it
    const urlParams = new URLSearchParams(window.location.search);
    const tokenFromUrl = urlParams.get('token');
    if (tokenFromUrl) {
      localStorage.setItem('ocms_token', tokenFromUrl);
      // Remove token from URL for security
      urlParams.delete('token');
      const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
      history.replaceState({}, '', newUrl);
    }
    
    // Initialize current date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    const token = localStorage.getItem('ocms_token');
    if (!token) window.location.href = '/auth/login.html';

    const $ = (id) => document.getElementById(id);
    const fmtDate = (d) => d ? new Date(d).toLocaleDateString() : '';
    const fmtCurrency = (amount) => `NPR ${parseFloat(amount || 0).toLocaleString()}`;

    // Navigation handling
    const panels = document.querySelectorAll('.panel');
    const navButtons = document.querySelectorAll('[data-section]');

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => switchSection(btn.dataset.section));
    });

    function switchSection(section) {
      // Update panels
      panels.forEach(p => p.classList.remove('active'));
      const targetPanel = document.getElementById(`section-${section}`);
      if (targetPanel) targetPanel.classList.add('active');

      // Update navigation
      navButtons.forEach(b => b.classList.remove('active'));
      const targetButton = document.querySelector(`[data-section="${section}"]`);
      if (targetButton) targetButton.classList.add('active');
    }

    // Logout functionality
    $('logoutBtn').addEventListener('click', () => {
      const btn = $('logoutBtn');
      const originalHTML = btn.innerHTML;

      // Show loading state
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Logging out...</span>';

      try {
        // Clear all auth tokens
        localStorage.removeItem('token');
        localStorage.removeItem('role');
        localStorage.removeItem('ocms_token');
        localStorage.removeItem('ocms_user_role');
        localStorage.removeItem('user');

        // Show success message
        showToast('Logged out successfully', 'success');

        // Redirect after short delay
        setTimeout(() => {
          window.location.href = '/auth/login.html';
        }, 1000);
      } catch (error) {
        console.error('Logout error:', error);
        // Force logout even if there's an error
        window.location.href = '/auth/login.html';
      }
    });

    // Toast notification system
    function showToast(message, type = 'info') {
      let toastContainer = document.getElementById('toast-container');
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 10000;
          font-family: 'Inter', sans-serif;
        `;
        document.body.appendChild(toastContainer);
      }

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
      `;
      toast.style.cssText = `
        background: ${type === 'error' ? 'linear-gradient(135deg, #ef4444, #dc2626)' : type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #3b82f6, #2563eb)'};
        color: white;
        padding: 14px 20px;
        border-radius: 12px;
        margin-bottom: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 500;
        border: 1px solid rgba(255, 255, 255, 0.2);
      `;

      toastContainer.appendChild(toast);

      // Auto remove after 4 seconds
      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        setTimeout(() => toast.remove(), 400);
      }, 4000);
    }

    // Add toast animations to document
    if (!document.getElementById('toast-styles')) {
      const style = document.createElement('style');
      style.id = 'toast-styles';
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    }

    // Stats rendering
    function setStats(stats = {}) {
      $('stat-enrollments').textContent = stats.enrollmentsTotal ?? 0;
      $('stat-active').textContent = stats.active ?? 0;
      $('stat-completed').textContent = stats.completed ?? 0;
      $('stat-certificates').textContent = stats.certificates ?? 0;
      $('stat-payments').textContent = stats.payments ?? 0;
      $('stat-quizzes').textContent = stats.quizAttempts ?? 0;
    }

    // Header rendering
    function renderHeader(user) {
      const name = `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'Student';
      $('welcomeName').textContent = name;
      $('userName').textContent = name;
      $('userEmail').textContent = user.email;
      $('avatar').textContent = (name || 'S').charAt(0).toUpperCase();
    }

    // Overview rendering with recent courses and activity
    function renderOverview(dashboard) {
      const loading = $('overview-loading');
      const content = $('overview-content');

      // Show recent courses
      const recentCourses = $('recent-courses');
      recentCourses.innerHTML = '';

      if (dashboard.lists?.enrollments?.length > 0) {
        const recentEnrollments = dashboard.lists.enrollments.slice(0, 3);
        recentEnrollments.forEach(enrollment => {
          const courseCard = document.createElement('div');
          courseCard.className = 'course-card';
          courseCard.innerHTML = `
            <div class="course-title">${enrollment.courseTitle || 'Course'}</div>
            <div class="course-meta">
              <span class="course-instructor">Enrolled ${fmtDate(enrollment.enrolled_at)}</span>
              <span class="course-price">${enrollment.status}</span>
            </div>
            <div class="course-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${enrollment.progress || 0}%"></div>
              </div>
              <div class="progress-text">${enrollment.progress || 0}% Complete</div>
            </div>
          `;
          recentCourses.appendChild(courseCard);
        });
      }

      // Show recent activity
      const recentActivity = $('recent-activity');
      recentActivity.innerHTML = '';

      if (dashboard.lists?.activities?.length > 0) {
        const activities = dashboard.lists.activities.slice(0, 5);
        activities.forEach(activity => {
          const li = document.createElement('li');
          li.className = 'list-item';
          li.innerHTML = `
            <div class="list-item-content">
              <h4>${activity.course?.title || activity.lesson?.title || 'Course Activity'}</h4>
              <p>${activity.action || 'Activity performed'}</p>
            </div>
            <div class="list-item-meta">${fmtDate(activity.created_at)}</div>
          `;
          recentActivity.appendChild(li);
        });
      } else {
        recentActivity.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No recent activity</div>';
      }

      // Hide loading, show content
      loading.style.display = 'none';
      content.style.display = 'block';
    }

    // Enrollments rendering
    function renderEnrollments(items = []) {
      const loading = $('enrollments-loading');
      const list = $('enrollments-list');

      loading.style.display = 'none';
      list.style.display = 'block';
      list.innerHTML = '';

      if (!items.length) {
        list.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">No enrollments yet. <a href="/student/courses.html" class="btn btn-primary" style="margin-top: 16px;">Browse Courses</a></div>';
        return;
      }

      items.forEach(e => {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.innerHTML = `
          <div class="list-item-content">
            <h4>${e.courseTitle || 'Course'}</h4>
            <p>Enrolled on ${fmtDate(e.enrolled_at)}</p>
          </div>
          <div class="list-item-meta">
            <span class="stat-badge">${e.status}</span>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // Progress rendering
    function renderProgress(items = []) {
      const loading = $('progress-loading');
      const list = $('progress-list');

      loading.style.display = 'none';
      list.style.display = 'block';
      list.innerHTML = '';

      if (!items.length) {
        list.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">Start learning to track your progress!</div>';
        return;
      }

      items.forEach(p => {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.innerHTML = `
          <div class="list-item-content">
            <h4>${p.courseTitle || 'Course'}</h4>
            <p>${p.percentage || 0}% complete</p>
            <div class="progress-bar" style="margin-top: 8px;">
              <div class="progress-fill" style="width: ${p.percentage || 0}%"></div>
            </div>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // Certificates rendering
    function renderCertificates(items = []) {
      const loading = $('certificates-loading');
      const list = $('certificates-list');

      loading.style.display = 'none';
      list.style.display = 'block';
      list.innerHTML = '';

      if (!items.length) {
        list.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">Complete courses to earn certificates!</div>';
        return;
      }

      items.forEach(c => {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.innerHTML = `
          <div class="list-item-content">
            <h4>${c.courseTitle || 'Certificate'}</h4>
            <p>Issued on ${fmtDate(c.issued_at)}</p>
          </div>
          <div class="list-item-meta">
            <span style="font-family: monospace; background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 4px 8px; border-radius: 4px;">${c.verification_code}</span>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // Payments rendering
    function renderPayments(items = []) {
      const loading = $('payments-loading');
      const list = $('payments-list');

      loading.style.display = 'none';
      list.style.display = 'block';
      list.innerHTML = '';

      if (!items.length) {
        list.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">No payment history found.</div>';
        return;
      }

      items.forEach(p => {
        const li = document.createElement('li');
        li.className = 'list-item';
        li.innerHTML = `
          <div class="list-item-content">
            <h4>${p.course?.title || 'Course Payment'}</h4>
            <p>${fmtDate(p.created_at)}</p>
          </div>
          <div class="list-item-meta">
            <div style="text-align: right;">
              <div style="font-weight: 600; color: #10b981;">${fmtCurrency(p.amount)}</div>
              <div style="font-size: 12px; color: #9ca3af;">${p.status}</div>
            </div>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // Reviews functionality
    async function loadReviewCourses() {
      try {
        const res = await fetch(`${API_URL}/enrollments/me`, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (res.ok) {
          const enrollments = await res.json();
          const courseSelect = $('reviewCourseId');
          courseSelect.innerHTML = '<option value="" style="background: #1f2937; color: #ffffff;">Choose a course...</option>';

          enrollments.forEach(enrollment => {
            const option = document.createElement('option');
            option.value = enrollment.course_id;
            option.textContent = enrollment.course?.title || `Course ${enrollment.course_id}`;
            option.style.background = '#1f2937';
            option.style.color = '#ffffff';
            courseSelect.appendChild(option);
          });
        }
      } catch (error) {
        console.error('Error loading courses for review:', error);
      }
    }

    function initRatingStars() {
      const stars = document.querySelectorAll('#ratingStars i');
      const ratingInput = $('reviewRating');

      stars.forEach((star, index) => {
        star.addEventListener('click', () => {
          const rating = index + 1;
          ratingInput.value = rating;

          // Update star display
          stars.forEach((s, i) => {
            if (i < rating) {
              s.classList.remove('far');
              s.classList.add('fas');
            } else {
              s.classList.remove('fas');
              s.classList.add('far');
            }
          });
        });

        star.addEventListener('mouseover', () => {
          stars.forEach((s, i) => {
            if (i <= index) {
              s.classList.add('active');
            } else {
              s.classList.remove('active');
            }
          });
        });

        star.addEventListener('mouseout', () => {
          stars.forEach(s => s.classList.remove('active'));
        });
      });
    }

    async function submitReview(event) {
      event.preventDefault();

      const courseId = $('reviewCourseId').value;
      const rating = $('reviewRating').value;
      const comment = $('reviewComment').value;

      if (!courseId || !rating || !comment.trim()) {
        showToast('Please fill in all fields', 'error');
        return;
      }

      const submitBtn = $('submitReviewBtn');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';

      try {
        const res = await fetch(`${API_URL}/reviews`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            course_id: parseInt(courseId),
            rating: parseInt(rating),
            comment: comment.trim()
          })
        });

        if (res.ok) {
          showToast('Review submitted successfully!', 'success');
          $('reviewForm').reset();
          document.querySelectorAll('#ratingStars i').forEach(star => {
            star.classList.remove('fas');
            star.classList.add('far');
          });
          loadReviews(); // Reload reviews
        } else {
          const error = await res.json();
          showToast(error.message || 'Failed to submit review', 'error');
        }
      } catch (error) {
        console.error('Error submitting review:', error);
        showToast('Network error. Please try again.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    }

    async function loadReviews() {
      const loading = $('reviews-loading');
      const content = $('reviews-content');
      const reviewsList = $('reviewsList');

      try {
        const res = await fetch(`${API_URL}/reviews/my-reviews`, {
          headers: { Authorization: `Bearer ${token}` }
        });

        loading.style.display = 'none';
        content.style.display = 'block';

        if (res.ok) {
          const reviews = await res.json();

          if (!reviews.length) {
            reviewsList.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">No reviews yet. Share your experience with courses you\'ve taken!</div>';
            return;
          }

          reviewsList.innerHTML = '';
          reviews.forEach(review => {
            const reviewCard = document.createElement('div');
            reviewCard.className = 'review-card';

            const stars = Array.from({length: 5}, (_, i) =>
              `<i class="fas fa-star" style="color: ${i < review.rating ? '#fbbf24' : '#d1d5db'}"></i>`
            ).join('');

            reviewCard.innerHTML = `
              <div class="review-header">
                <div class="review-course">${review.course?.title || 'Course'}</div>
                <div class="review-date">${fmtDate(review.created_at)}</div>
              </div>
              <div class="review-rating">${stars}</div>
              <div class="review-comment">${review.comment}</div>
            `;

            reviewsList.appendChild(reviewCard);
          });
        } else {
          reviewsList.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">Unable to load reviews</div>';
        }
      } catch (error) {
        console.error('Error loading reviews:', error);
        reviewsList.innerHTML = '<div class="muted" style="text-align: center; padding: 40px;">Error loading reviews</div>';
      }
    }

    // Notifications rendering
    function renderNotifications(items = [], activities = []) {
      const loading = $('notifications-loading');
      const content = $('notifications-content');
      const notifList = $('notifications-list');
      const activityList = $('activities-list');

      loading.style.display = 'none';
      content.style.display = 'block';

      // Render notifications
      notifList.innerHTML = '';
      if (!items.length) {
        notifList.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No new notifications</div>';
      } else {
        items.forEach(n => {
          const li = document.createElement('li');
          li.className = 'list-item';
          li.innerHTML = `
            <div class="list-item-content">
              <h4>${n.title || 'Notification'}</h4>
              <p>${n.message}</p>
            </div>
            <div class="list-item-meta">${fmtDate(n.created_at)}</div>
          `;
          notifList.appendChild(li);
        });
      }

      // Render activities
      activityList.innerHTML = '';
      if (!activities.length) {
        activityList.innerHTML = '<div class="muted" style="text-align: center; padding: 20px;">No recent activity</div>';
      } else {
        activities.forEach(a => {
          const li = document.createElement('li');
          li.className = 'list-item';
          li.innerHTML = `
            <div class="list-item-content">
              <h4>${a.course?.title || a.lesson?.title || 'Activity'}</h4>
              <p>${a.action || 'Activity performed'}</p>
            </div>
            <div class="list-item-meta">${fmtDate(a.created_at)}</div>
          `;
          activityList.appendChild(li);
        });
      }
    }

    // Bootstrap the dashboard
    async function bootstrap() {
      try {
        const res = await fetch(`${API_URL}/profile/me`, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (res.status === 401) throw new Error('unauthorized');

        const payload = await res.json();

        // Check if user is actually a student
        if (payload.dashboard?.role !== 'STUDENT') {
          showToast('Redirecting to appropriate dashboard...', 'info');
          setTimeout(() => {
            window.location.href = payload.dashboard?.role === 'INSTRUCTOR'
              ? '/instructor/instructor-dashboard.html'
              : '/admin/dashboard.html';
          }, 1500);
          return;
        }

        // Render all dashboard data
        renderHeader(payload.user);
        $('roleBadge').textContent = payload.dashboard.role;
        setStats(payload.dashboard.stats);
        renderOverview(payload.dashboard);
        renderEnrollments(payload.dashboard.lists?.enrollments || []);
        renderProgress(payload.dashboard.charts?.progress || []);
        renderCertificates(payload.dashboard.lists?.certificates || []);
        renderPayments(payload.dashboard.lists?.payments || []);
        renderNotifications(payload.dashboard.lists?.notifications || [], payload.dashboard.lists?.activities || []);

        // Initialize reviews functionality
        loadReviewCourses();
        initRatingStars();
        loadReviews();

        showToast('Dashboard loaded successfully!', 'success');

      } catch (err) {
        console.error('Dashboard error:', err);
        localStorage.removeItem('ocms_token');
        showToast('Session expired. Please login again.', 'error');
        setTimeout(() => {
          window.location.href = '/auth/login.html';
        }, 2000);
      }
    }

    // Initialize dashboard
    bootstrap();

    // Add some interactive features
    document.addEventListener('DOMContentLoaded', () => {
      // Add smooth scrolling for navigation
      navButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const section = btn.dataset.section;
          switchSection(section);

          // Smooth scroll to top if needed
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      });

      // Add review form submission
      const reviewForm = $('reviewForm');
      if (reviewForm) {
        reviewForm.addEventListener('submit', submitReview);
      }

      // Add keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case '1': e.preventDefault(); switchSection('overview'); break;
            case '2': e.preventDefault(); switchSection('courses'); break;
            case '3': e.preventDefault(); switchSection('enrollments'); break;
            case '4': e.preventDefault(); switchSection('resources'); break;
            case '5': e.preventDefault(); switchSection('progress'); break;
            case '6': e.preventDefault(); switchSection('reviews'); break;
          }
        }
      });

      // Add loading animation to stat cards
      const statCards = document.querySelectorAll('.stat-card');
      statCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in');
      });
    });
  </script>
</body>
</html>
